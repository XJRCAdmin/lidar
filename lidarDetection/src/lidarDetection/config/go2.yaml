# Obstacle Detector Node 参数配置
obstacle_detector_node:
  ros__parameters:
    lidar_points_topic: "/livox/lidar"
    odom_topic: "/Odometry"
    cloud_ground_topic: "/cloud_ground"
    cloud_clusters_topic: "/cloud_clusters"
    marker_bboxes_topic: "/marker_bboxes"
    objects_topic: "/detected_objects"
    bbox_target_frame: "lidar_body"
    
    # 滤去自身点云
    min_x: -0.1
    min_y: -0.1
    min_z: -0.1
    max_x: 0.1
    max_y: 0.1
    max_z: 0.1
    
    # LiDAR相对于robot的安装位置和姿态,也可以改launch中的
    rotate_x: 0.0        # X轴平移 (米) - 前后位置, 范围: [-10, 10]
    rotate_y: 0.0        # Y轴平移 (米) - 左右位置, 范围: [-10, 10]
    rotate_z: 0.0        # Z轴平移 (米) - 高度, 范围: [-10, 10]
    rotate_roll: 0.0     # 横滚角 (弧度) - 绕X轴旋转, 范围: [-3.14, 3.14]
    rotate_pitch: 0.0    # 俯仰角 (弧度) - 绕Y轴旋转, 范围: [-3.14, 3.14]
    rotate_yaw: 0.0      # 偏航角 (弧度) - 绕Z轴旋转, 范围: [-3.14, 3.14]
    
    use_pca_box: true          # 使用PCA边界框 (vs 轴对齐边界框)
    use_tracking: true         # 启用目标跟踪功能
    
    voxel_grid_size: 0.2       # 体素网格大小 (米) - 点云下采样分辨率, 范围: [0.05, 1.0]
    
    # 只检测该区域内的点云, 调大会导致墙体一起被纳入
    roi_max_x: 5.0       # point1前方 (米), 范围: [0.0, 8.0]
    roi_max_y: 5.0       # point1右侧 (米), 范围: [0.0, 8.0]
    roi_max_z: 2.0       # point1向上 (米), 范围: [0.0, 3.0]
    roi_min_x: -4.0      # point2后方 (米) - 负值, 范围: [-8.0, 0.0]
    roi_min_y: -4.0      # point2左侧 (米) - 负值, 范围: [-8.0, 0.0]
    roi_min_z: -0.5      # point2向下 (米) - 负值, 范围: [-1.0, 0.0]
    
    ground_segment: "RANSAC"   # 地面分割算法类型
    ground_threshold: 0.3      # 地面高度阈值 (米) - 地面平面的容差, 范围: [0.0, 1.0]
    
    # 可以调节这些参数来优化聚类效果
    cluster_threshold: 0.6     # 聚类距离阈值 (米) - 点间最大距离, 范围: [0.1, 3.0]
    cluster_max_size: 500      # 聚类最大点数 - 单个障碍物最大点数, 范围: [10, 2000]
    cluster_min_size: 10       # 聚类最小点数 - 过滤小噪声, 范围: [3, 50]
    
    # 可以设置大一些, 以免漏检
    displacement_threshold: 1.0   # 位移阈值 (米) - 帧间最大移动距离, 范围: [0.1, 5.0]
    iou_threshold: 1.0            # IoU阈值 - 边界框重叠度匹配, 范围: [0.1, 1.0]
    
    # 可以适当调节, 影响离群点滤波效果
    enable_statistical_filter: true     # 启用统计离群点滤波
    statistical_nb_neighbors: 20        # 邻居点数量 - 统计分析的近邻点数, 范围: [10, 100]
    statistical_std_ratio: 1.0          # 标准差倍数 - 离群点判定阈值 (越小越严格), 范围: [0.1, 4.0]
    
    # 用于过滤异常长宽高比例的bbox 未启用
    max_dimension_ratio: 5.0     # 边界框最大长宽高比例 (最长边/最短边), 范围: [5.0, 10.0]
    
    # 未完全启用, 调了也可能没用
    enable_height_range_filter: false   # 启用高度和范围滤波
    height_limit: 2.0                   # 最大高度限制 (米) - 过滤高空点云, 范围: [0.5, 3.0]
    range_length: 5.0                   # 前后范围 (米) - robot前后方向感兴趣距离, 范围: [0.5, 10.0]
    range_width: 5.0                    # 左右范围 (米) - robot左右方向感兴趣距离, 范围: [0.5, 10.0]

odom_trans_node:
  ros__parameters:
    input_odom_topic: "/Odometry"
    output_odom_topic: "/odom_base_link"
    source_frame: "lidar_body"
    target_frame: "base_link"

obstacle_to_baselink_node:
  ros__parameters:
    obstacle_lidar_topic: "/detected_objects"
    obstacle_baselink_topic: "/obstacle_information_in_baselink"
    source_frame: "lidar_body"
    target_frame: "base_link"

interface_node:
  ros__parameters:
    input_topic_odom: "/odom_base_link"
    output_topic_robot_state: "/robot_state"
    input_relative_ball_topic: "/obstacle_information_in_baselink"
    output_relative_ball_topic: "/ball_relative"
    input_map_ball_topic: "/obstacle_information_in_baselink"
    output_map_ball_topic: "/ball_map"
    source_frame: "base_link"
    target_frame: "base_link"
    robot_radius: 0.5  # robot 半径 (米)
